<ngx-spinner bdColor="#fff" size="medium" color="#fff">
  <p style="font-size: 20px; color: white" class="loaderbg">
      <img src="assets/img/favicon.jpg" class="loader-logo" width="100" />
  </p>
</ngx-spinner>

<section class="container-fluid bg-blue py-3 py-md-4">
  <div class="max-w-1200">
    <div class="d-flex flex-nowwrap align-items-center">

      <div class="banner d-flex flex-column flex-md-row flex-md-nowrap align-items-md-center" [ngClass]="{sticked: isFinderSticked}">
        <span class="text-light font-mg-big pr-3 pr-lg-5">we provide online services!!!!!</span>
        <span class="bg-orange px-3 py-2 mt-2 mt-md-0 rounded font-italic">
          Look for
          <i class="fas fa-video px-1"></i>
          to find virtural services
        </span>
      </div>
  
      <div class="arrow-right flex-shrink-0 flex-grow-0 ml-3 ml-lg-5"></div>  
    </div>  
  </div>
</section>

<div class="intersection-observer" intersectionObserver (changeStatus)="changeStickyStatus($event)"></div>
<section class="container-fluid mt-5 pt-2 sticky-top blur">
  <div class="max-w-1200">
    <h2 class="text-blue-gradient font-weight-normal">Expert Finder</h2>
    <ul class="filters pt-2 pb-3 m-0 d-flex flex-nowrap list-unstyled">
      <li class='mr-3' *ngFor="let f of filters;">
        <button class="btn border-darkblue text-darkblue text-nowrap py-2 px-4 rounded-pill" 
          [ngClass]="{active: (filterTarget == f.id)}"
          (click)="setFilterTarget(f.id)"
        >{{f.label}}</button>
      </li>
    </ul>
    <filter-dropdown class="position-absolute shadow rounded-15p bg-white" *ngIf="filterTarget" [ngStyle]="getFilterDropdownPosition()"></filter-dropdown>
  </div>
</section>

<section class="container-fluid bg-lightblue">
  <div class="row align-items-start">
    <div class="col-12 col-md-6 d-md-block pt-5 min-h-100-finder"
      [ngClass]="{'d-none': isMapView, 'col-lg-9': !isMapSizeBig, 'col-lg-3': isMapSizeBig}"
    >
      <div class="container-fluid postiion-relative">
        <p class="font-italic">Here are the options we found for you</p>
        <ul class="professionals list-unstyled row">
          <li class="col-12 mb-3"
            [ngClass]="{'col-lg-4': !isMapSizeBig}"
          >
            <div class="card p-3 text-center border-blue rounded-15p font-small">
              <div class="img-wrapper">
                <img src="/assets/img/no-image.jpg" alt="" class="full">
              </div>
              <star-rate class="my-3" [rate]="3.7" margin="small" size="small"></star-rate>
              <p class="mb-1">6042677463</p>
              <p class="mb-3 address">10318 Whalley Blvd, <br>Surrey, BC V3T 4H4, Canada</p>
              <div>
                <button class="btn border-darkblue text-darkblue rounded-10p">compare</button>
              </div>
            </div>
          </li>
  
          <li class="col-12 mb-3"
            [ngClass]="{'col-lg-4': !isMapSizeBig}"
          >
            <div class="card p-3 text-center border-blue rounded-15p font-small">
              <div class="img-wrapper">
                <img src="/assets/img/no-image.jpg" alt="" class="rounded-circle">
              </div>
              <div class="price-tag bg-tagblue font-weight-bold">$6000/hr</div>
              <star-rate class="my-3" [rate]="3.7" margin="small" size="small"></star-rate>
              <p class="mb-1">6042677463</p>
              <p class="mb-3 address">10318 Whalley Blvd, <br>Surrey, BC V3T 4H4, Canada</p>
              <div>
                <button class="btn border-darkblue text-darkblue rounded-10p">compare</button>
              </div>
            </div>
          </li>
  
          <li class="col-12 mb-3"
            [ngClass]="{'col-lg-4': !isMapSizeBig}"
          >
            <div class="card p-3 text-center border-blue rounded-15p font-small">
              <div class="img-wrapper">
                <img src="/assets/img/no-image.jpg" alt="" class="rounded-circle">
              </div>
              <div class="price-tag bg-tagblue font-weight-bold">$6000/hr</div>
              <star-rate class="my-3" [rate]="3.7" margin="small" size="small"></star-rate>
              <p class="mb-1">6042677463</p>
              <p class="mb-3 address">10318 Whalley Blvd, <br>Surrey, BC V3T 4H4, Canada</p>
              <div>
                <button class="btn border-darkblue text-darkblue rounded-10p">compare</button>
              </div>
            </div>
          </li>
          <li class="col-12 mb-3"
            [ngClass]="{'col-lg-4': !isMapSizeBig}"
          >
            <div class="card p-3 text-center border-blue rounded-15p font-small">
              <div class="img-wrapper">
                <img src="/assets/img/no-image.jpg" alt="" class="rounded-circle">
              </div>
              <div class="price-tag bg-tagblue font-weight-bold">$6000/hr</div>
              <star-rate class="my-3" [rate]="3.7" margin="small" size="small"></star-rate>
              <p class="mb-1">6042677463</p>
              <p class="mb-3 address">10318 Whalley Blvd, <br>Surrey, BC V3T 4H4, Canada</p>
              <div>
                <button class="btn border-darkblue text-darkblue rounded-10p">compare</button>
              </div>
            </div>
          </li>
          <li class="col-12 mb-3"
            [ngClass]="{'col-lg-4': !isMapSizeBig}"
          >
            <div class="card p-3 text-center border-blue rounded-15p font-small">
              <div class="img-wrapper">
                <img src="/assets/img/no-image.jpg" alt="" class="rounded-circle">
              </div>
              <div class="price-tag bg-tagblue font-weight-bold">$6000/hr</div>
              <star-rate class="my-3" [rate]="3.7" margin="small" size="small"></star-rate>
              <p class="mb-1">6042677463</p>
              <p class="mb-3 address">10318 Whalley Blvd, <br>Surrey, BC V3T 4H4, Canada</p>
              <div>
                <button class="btn border-darkblue text-darkblue rounded-10p">compare</button>
              </div>
            </div>
          </li>
          <li class="col-12 mb-3"
            [ngClass]="{'col-lg-4': !isMapSizeBig}"
          >
            <div class="card p-3 text-center border-blue rounded-15p font-small">
              <div class="img-wrapper">
                <img src="/assets/img/no-image.jpg" alt="" class="rounded-circle">
              </div>
              <div class="price-tag bg-tagblue font-weight-bold">$6000/hr</div>
              <star-rate class="my-3" [rate]="3.7" margin="small" size="small"></star-rate>
              <p class="mb-1">6042677463</p>
              <p class="mb-3 address">10318 Whalley Blvd, <br>Surrey, BC V3T 4H4, Canada</p>
              <div>
                <button class="btn border-darkblue text-darkblue rounded-10p">compare</button>
              </div>
            </div>
          </li>
          <li class="col-12 mb-3"
            [ngClass]="{'col-lg-4': !isMapSizeBig}"
          >
            <div class="card p-3 text-center border-blue rounded-15p font-small">
              <div class="img-wrapper">
                <img src="/assets/img/no-image.jpg" alt="" class="rounded-circle">
              </div>
              <div class="price-tag bg-tagblue font-weight-bold">$6000/hr</div>
              <star-rate class="my-3" [rate]="3.7" margin="small" size="small"></star-rate>
              <p class="mb-1">6042677463</p>
              <p class="mb-3 address">10318 Whalley Blvd, <br>Surrey, BC V3T 4H4, Canada</p>
              <div>
                <button class="btn border-darkblue text-darkblue rounded-10p">compare</button>
              </div>
            </div>
          </li>

        </ul>

        <div class="d-flex flex-nowrap justify-content-center pt-2 pb-5">
          <div class="paginator point mr-1 active"></div>
          <div class="paginator point mr-1"></div>
          <div class="paginator point mr-1"></div>
          <div class="paginator next"></div>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6 d-none d-md-block sticky-to-finder h-100--finder bg-white"
      [ngClass]="{'d-none': !isMapView, 'col-lg-9': isMapSizeBig, 'col-lg-3': !isMapSizeBig}"
    >
      <agm-map 
        [latitude]="12"
        [longitude]="50"
        [zoom]="6"
        [disableDefaultUI]="false"
        [zoomControl]="false"
      ></agm-map>
      <button class="btn switch-change-map-size d-none d-md-block text-blue font-biggest" (click)="toggleMapSize()">
        <i *ngIf="!isMapSizeBig" class="fas fa-expand"></i>
        <i *ngIf="isMapSizeBig" class="fas fa-compress"></i>
      </button>
    </div>
  </div>
  
</section>

<button class="btn switch-ui d-md-none font-biggest text-blue blur" (click)="toggleView()">
  <i *ngIf="!isMapView" class="fas fa-map-marked-alt"></i>
  <i *ngIf="isMapView" class="fas fa-list"></i>
</button>





<section class="pt-5 pb-5 position-relative">
  <agm-map [latitude]="lat" [longitude]="long" [scrollwheel]="true" [fullscreenControl]="true"  [mapTypeId]="'hybrid'" >
  <agm-marker [latitude]="lat" [longitude]="long"></agm-marker>
  </agm-map>
  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-3">
       <div class="text-right mb-3">
         <button class="btn btn-primary" (click)="removeFilter()">Remove All Filters</button>
       </div>
        <h6 class="mb-3 text-primary">Travel Distance from Postal Code</h6>

        <div class="mb-3">
          <input 
            name="address" 
            type="text"
            [(ngModel)]="currentAddress"
            class="form-control"
            #searchGlobal
          />
        </div>

        <div class="mb-3">
          <div class="radio">
            <span>Distance Range</span>
            <input type="range"  class="custom-range" min="5" [(ngModel)] = "listingPayload.miles" max="100" (input) ="changeMiles($event)" id="customRange2">
              Kms: {{listingPayload.miles}}
          </div>
        </div>

        <hr />

        <h6 class="mb-3 text-primary">Gender</h6>
        <div class="mb-3">
          <div class="radio">
              <select class="form-control" 
              #userType
              [(ngModel)]="listingPayload.gender"
              (change)="onOptionsSelected(userType.value, 'gender')">
                <option value="">All</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            <!-- <span>Distance Range</span> -->
            <!-- <input type="range" class="custom-range" min="5" [(ngModel)] = "listingPayload.miles" max="100" (input) ="changeMiles($event)" id="customRange2">
              Kms: {{listingPayload.miles}} -->
          </div>
        </div>
        <hr>
        <h6 class="mb-3 text-primary">Professional name</h6>

        <div class="d-flex mb-3">
          <div class="ng-autocomplete">
            <ng-autocomplete 
              [data]="allDoctorList"
              placeHolder="Enter the Service Provider Name"
              [searchKeyword]="keyword"
              (selected)='selectEvent($event)'
              (inputCleared)="resetNames()"
              [itemTemplate]="itemTemplate"
              [notFoundTemplate]="notFoundTemplate">                                 
            </ng-autocomplete>
             
            <ng-template #itemTemplate let-item>
            <a [innerHTML]="item.name"></a>
            </ng-template>
             
            <ng-template #notFoundTemplate let-notFound>
            <div [innerHTML]="notFound"></div>
            </ng-template>
           </div>
        </div>
        <hr />

        <h6 class="mb-3 text-primary">Ratings</h6>
        <div class="mb-3">
          <select class="form-control"  [(ngModel)]="listingPayload.rating"  #ratings (change)="onOptionsSelected(ratings.value, 'rating')">
            
            <option *ngFor="let opt of ratingsOption" [value] = "opt._id" [id]="opt._id">{{opt.item_text}}</option>
          </select>
        </div>
        <hr />

        <h6 class="mb-3 text-primary">Hours of Availability</h6>
       
        <div class="mb-3">
          <select class="form-control" [(ngModel)]="listingPayload.typicalHoursId"  #hours (change)="onOptionsSelected(hours.value, 'hours')">
          <option value = ''>All</option>
          <option *ngFor="let opt of avalibilityQuestion?.answers" [value] = "opt._id" [id]="opt._id">{{opt.item_text}}</option>
        </select>
        </div>
        <hr />

        <h6 class="mb-3 text-primary">Provider language</h6>
       
        <div class="mb-3">
          <select class="form-control" [(ngModel)]="listingPayload.languageId"  #language (change)="onOptionsSelected(language.value, 'language')">
            <option value = ''>All</option>
            <option *ngFor="let opt of languageQuestion?.answers" [value] = "opt._id" [id]="opt._id">{{opt.item_text}}</option>
          </select>
        </div>
        <hr/>

        <h6 class="mb-3 text-primary">Service Type</h6>
       
        <div class="mb-3">
          <select class="form-control"  [(ngModel)]="listingPayload.serviceOfferId"  #serviceType 
          (change)="onOptionsSelected(serviceType.value, 'serviceType')">
            <option value = ''>All</option>
            <option *ngFor="let opt of serviceQuestion?.answers" [value] = "opt._id" [id]="opt._id">{{opt.item_text}}</option>
          </select>
        </div>
        <hr/>
        <h6 class="mb-3 text-primary">Price Range</h6>

        <div class="mb-3">
          <!-- <div class="row">
            <div  class="col-md-12" *ngFor="let item of priceList; let i = index">       
              <label for="{{item.id}}" >
                  <input class="radio" type="radio" name="price_range" [(ngModel)] ="listingPayload.price_per_hours"  
                  value="{{item.name}}"  required id="{{item.id}}" (change)="changePrice(item.name)" />
                  <span class="text-body" style="margin-left: 5px;">{{item.name}}</span>
              </label>
            </div>
          </div> -->
          <select class="form-control"  [(ngModel)]="listingPayload.price_per_hours"
          #priceRange (change)="onOptionsSelected(priceRange.value, 'price')">
            <option *ngFor="let opt of priceList" [value] = "opt.value">{{opt.name}}</option>
          </select>
        </div>

        <hr />
        <h6 class="mb-3 text-primary">Specialty Age Group</h6>

        <div class="mb-3">
          <div class="row">
            <div  class="col-md-12" *ngFor="let item of ageRangeList; let i = index">       
              <label for="{{item.id}}" >
                  <input class="radio" type="radio" name="age_range" [(ngModel)] ="listingPayload.age_range[0]"  value="{{item.id}}"  required id="{{item.id}}" (change)="changeAge($event)" />
                  <span class="text-body" style="margin-left: 5px;">{{item.name}}</span>
              </label>
            </div>
          </div>
        </div>


        <hr/>

      </div>
      <div class="col-12 col-lg-9">
        <div
          class="d-flex align-items-center justify-content-between text-primary flex-wrap flex-md-nowrap"
        >
          <h3 class="mb-3">Expert Finder</h3>
          <div class="text-primary h6 mb-3">
            Number of professionals that meet all your criteria
            <span class="badge badge-secondary"
              >{{ doctorsListing.length }}</span
            >
          </div>
        </div>

        <hr class="mt-0" />

        <div class="p-3 bg-light mb-3 text-right" *ngIf="compareList.length">
          <div
            class="d-inline-flex bg-white compareprofilebox"
            *ngFor="let doc of compareList"
          >
            <a (click)="removefromCopare(doc.userId)" class="fa fa-times"></a>
            <img
              [src]="'https://api.prompthealth.ca/users/'+ doc.userData.profileImage"
              class="compareprofileimg"
              *ngIf="doc.userData.profileImage"
            />
            <img
              *ngIf="!doc.userData.profileImage"
              src="/assets/img/default_user.jpg"
              class="compareprofileimg noimage"
            />
            <div class="p-2">
              <div class="font-weight-bold mb-2">
                {{ doc.userData.firstName }} {{ doc.userData.lastName }}
              </div>
              <div class="mb-2 font-weight-normal" *ngIf="loggedInUser">
                {{ doc.userData.email }}
              </div>
              <div class="text-review mb-2" *ngIf="doc.userData.ratingAvg">
                <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 5">
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                </div>
                <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 4">
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="far fa-star"></i>
                </div>
                <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 3">
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                </div>
                <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 2">
                  <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                </div>
                <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 1">
                  <i class="fa fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="d-inline-block text-center">
            <div class="mb-2">
              <a class="text-primary" href="javascript:void(0)" (click)="clearCompareList()">Clear All</a>
            </div>
            <a (click)="compareDoc()" class="btn btn-outline-primary"
              >Compare</a
            >
          </div>
        </div>

        <div
          class="row m-0 shadow-sm overflow-hidden profileBox mb-4"
          *ngFor="let doc of doctorsListing"
        >
          <div class="col-12 col-lg-3 p-0">
            <!-- <img
              [src]="'https://api.prompthealth.ca/users/'+doc?.userData?.profileImage"
              class="profileimg" /> -->
            <div
              class="w-100 h-100 profileimg"
              [ngStyle]="{'background-image': 'url(https://api.prompthealth.ca/users/'+ doc.userData.profileImage +')'}"
            >
          
          </div>
          </div>
          <div class="col-12 col-lg-9 p-3">
            <div
              class="d-flex justify-content-between align-items-start flex-wrap flex-md-nowrap"
            >
              <div class="text-primary">
                <a
                  href="/dashboard/detail"
                  [routerLink]="['/dashboard/detail', doc.userId]"
                  class="d-block h5 text-uppercase mb-0"
                  >{{ doc.userData.firstName }} {{ doc.userData.lastName }}</a
                >
                <div class="mb-2 font-weight-normal" *ngIf="loggedInUser">
                  {{doc.userData.email}}
                </div>
                <div class="text-review mb-2" *ngIf="doc.userData.ratingAvg">
                  <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 5">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                  </div>
                  <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 4">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="far fa-star"></i>
                  </div>
                  <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 3">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                  </div>
                  <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 2">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                  </div>
                  <div class="text-rating mb-2" *ngIf="doc.userData.ratingAvg === 1">
                    <i class="fa fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                  </div>
                </div>
              </div>

              <div class="ml-0 ml-md-3 mb-2 d-flex justify-content-center">
                <span class="like-input mr-2" *ngIf="loggedInUser && loggedInRole === 'U'">
                  <input type="checkbox" (change)="likeProfile($event, doc.userId)"/>
                  <i class="fa fa-heart"></i>
                </span>

              <div class="checkboxBtn">
                <input
                  type="checkbox"
                  [id]="doc.userId"
                  value="{{doc.userId}}"
                  (change)="compareFields(doc, $event)"
                />
                <span class="btn btn-outline-primary">
                    <i class="far fa-square"></i>
                  <i class="fa fa-check-square"></i>
                  Compare
                </span>
              </div>
              </div>
            </div>

            <div class="mb-2">
              <a
                class="fa fa-phone text-secondary d-inline-block mr-2"
                href="tel:{{doc.userData.phone}}"
              >
                <span>{{doc.userData.phone}}</span>
              </a>
              <a *ngIf="loggedInUser"
                class="fa fa-envelope text-secondary d-inline-block mr-2"
                href="mailto:{{doc.userData.address}}"
              >
                <span>{{doc.userData.email}}</span>
              </a>
            </div>
            <div class="mb-2" *ngIf="doc?.userData.calcDistance">Distance: {{doc?.userData.calcDistance | number: '1.0-0'}} KMs</div>
            <div class="mb-2" *ngIf="doc.userData.address">Address</div>
            <div class="desciption text-truncate">
              {{doc.userData.address}}
              <a
                [routerLink]="['/dashboard/detail', doc.userId]"
                class="text-primary font-weight-normal pull-right"
                >Go To Profile <i class="fa fa-chevron-right"></i
              ></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
